/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@codemirror/lang-markdown@0.20.0/dist/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{EditorSelection,Prec}from"@codemirror/state";import{keymap}from"@codemirror/view";import{defineLanguageFacet,foldNodeProp,indentNodeProp,languageDataProp,Language,LanguageDescription,ParseContext,syntaxTree,LanguageSupport}from"@codemirror/language";import{parser,GFM,Subscript,Superscript,Emoji,MarkdownParser,parseCode}from"@lezer/markdown";import{html}from"@codemirror/lang-html";const data=defineLanguageFacet({block:{open:"\x3c!--",close:"--\x3e"}}),commonmark=parser.configure({props:[foldNodeProp.add((e=>{if(e.is("Block")&&!e.is("Document"))return(e,t)=>({from:t.doc.lineAt(e.from).to,to:e.to})})),indentNodeProp.add({Document:()=>null}),languageDataProp.add({Document:data})]});function mkLang(e){return new Language(data,e)}const commonmarkLanguage=mkLang(commonmark),extended=commonmark.configure([GFM,Subscript,Superscript,Emoji]),markdownLanguage=mkLang(extended);function getCodeParser(e,t){return r=>{let n=r&&LanguageDescription.matchLanguageName(e,r,!0);return n?n.support?n.support.language.parser:ParseContext.getSkippingParser(n.load()):t?t.parser:null}}function nodeStart(e,t){return t.sliceString(e.from,e.from+50)}class Context{constructor(e,t,r,n,o,a,i){this.node=e,this.from=t,this.to=r,this.spaceBefore=n,this.spaceAfter=o,this.type=a,this.item=i}blank(e=!0){let t=this.spaceBefore;if("Blockquote"==this.node.name)t+=">";else for(let e=this.to-this.from-t.length-this.spaceAfter.length;e>0;e--)t+=" ";return t+(e?this.spaceAfter:"")}marker(e,t){let r="OrderedList"==this.node.name?String(+itemNumber(this.item,e)[2]+t):"";return this.spaceBefore+r+this.type+this.spaceAfter}}function getContext(e,t,r){let n=[];for(let t=e;t&&"Document"!=t.name;t=t.parent)"ListItem"!=t.name&&"Blockquote"!=t.name||n.push(t);let o=[],a=0;for(let e=n.length-1;e>=0;e--){let i,m=n[e],s=a;if("Blockquote"==m.name&&(i=/^[ \t]*>( ?)/.exec(t.slice(a))))a+=i[0].length,o.push(new Context(m,s,a,"",i[1],">",null));else if("ListItem"==m.name&&"OrderedList"==m.parent.name&&(i=/^([ \t]*)\d+([.)])([ \t]*)/.exec(nodeStart(m,r)))){let e=i[3],t=i[0].length;e.length>=4&&(e=e.slice(0,e.length-4),t-=4),a+=t,o.push(new Context(m.parent,s,a,i[1],e,i[2],m))}else if("ListItem"==m.name&&"BulletList"==m.parent.name&&(i=/^([ \t]*)([-+*])([ \t]{1,4}\[[ xX]\])?([ \t]+)/.exec(nodeStart(m,r)))){let e=i[4],t=i[0].length;e.length>4&&(e=e.slice(0,e.length-4),t-=4);let r=i[2];i[3]&&(r+=i[3].replace(/[xX]/," ")),a+=t,o.push(new Context(m.parent,s,a,i[1],e,r,m))}}return o}function itemNumber(e,t){return/^(\s*)(\d+)(?=[.)])/.exec(t.sliceString(e.from,e.from+10))}function renumberList(e,t,r,n=0){for(let o=-1,a=e;;){if("ListItem"==a.name){let e=itemNumber(a,t),i=+e[2];if(o>=0){if(i!=o+1)return;r.push({from:a.from+e[1].length,to:a.from+e[0].length,insert:String(o+2+n)})}o=i}let e=a.nextSibling;if(!e)break;a=e}}const insertNewlineContinueMarkup=({state:e,dispatch:t})=>{let r=syntaxTree(e),{doc:n}=e,o=null,a=e.changeByRange((t=>{if(!t.empty||!markdownLanguage.isActiveAt(e,t.from))return o={range:t};let a=t.from,i=n.lineAt(a),m=getContext(r.resolveInner(a,-1),i.text,n);for(;m.length&&m[m.length-1].from>a-i.from;)m.pop();if(!m.length)return o={range:t};let s=m[m.length-1];if(s.to-s.spaceAfter.length>a-i.from)return o={range:t};let l=a>=s.to-s.spaceAfter.length&&!/\S/.test(i.text.slice(s.to));if(s.item&&l){if(s.node.firstChild.to>=a||i.from>0&&!/[^\s>]/.test(n.lineAt(i.from-1).text)){let e,t=m.length>1?m[m.length-2]:null,r="";t&&t.item?(e=i.from+t.from,r=t.marker(n,1)):e=i.from+(t?t.to:0);let o=[{from:e,to:a,insert:r}];return"OrderedList"==s.node.name&&renumberList(s.item,n,o,-2),t&&"OrderedList"==t.node.name&&renumberList(t.item,n,o),{range:EditorSelection.cursor(e+r.length),changes:o}}{let t="";for(let e=0,r=m.length-2;e<=r;e++)t+=m[e].blank(e<r);return t+=e.lineBreak,{range:EditorSelection.cursor(a+t.length),changes:{from:i.from,insert:t}}}}if("Blockquote"==s.node.name&&l&&i.from){let r=n.lineAt(i.from-1),o=/>\s*$/.exec(r.text);if(o&&o.index==s.from){let n=e.changes([{from:r.from+o.index,to:r.to},{from:i.from+s.from,to:i.to}]);return{range:t.map(n),changes:n}}}let u=[];"OrderedList"==s.node.name&&renumberList(s.item,n,u);let f=e.lineBreak,g=s.item&&s.item.from<i.from;if(!g||/^[\s\d.)\-+*>]*/.exec(i.text)[0].length>=s.to)for(let e=0,t=m.length-1;e<=t;e++)f+=e!=t||g?m[e].blank():m[e].marker(n,1);let c=a;for(;c>i.from&&/\s/.test(i.text.charAt(c-i.from-1));)c--;return u.push({from:c,to:a,insert:f}),{range:EditorSelection.cursor(c+f.length),changes:u}}));return!o&&(t(e.update(a,{scrollIntoView:!0,userEvent:"input"})),!0)};function isMark(e){return"QuoteMark"==e.name||"ListMark"==e.name}function contextNodeForDelete(e,t){let r=e.resolveInner(t,-1),n=t;isMark(r)&&(n=r.from,r=r.parent);for(let e;e=r.childBefore(n);)if(isMark(e))n=e.from;else{if("OrderedList"!=e.name&&"BulletList"!=e.name)break;r=e.lastChild,n=r.to}return r}const deleteMarkupBackward=({state:e,dispatch:t})=>{let r=syntaxTree(e),n=null,o=e.changeByRange((t=>{let o=t.from,{doc:a}=e;if(t.empty&&markdownLanguage.isActiveAt(e,t.from)){let e=a.lineAt(o),n=getContext(contextNodeForDelete(r,o),e.text,a);if(n.length){let r=n[n.length-1],a=r.to-r.spaceAfter.length+(r.spaceAfter?1:0);if(o-e.from>a&&!/\S/.test(e.text.slice(a,o-e.from)))return{range:EditorSelection.cursor(e.from+a),changes:{from:e.from+a,to:o}};if(o-e.from==a){let n=e.from+r.from;if(r.item&&r.node.from<r.item.from&&/\S/.test(e.text.slice(r.from,r.to)))return{range:t,changes:{from:n,to:e.from+r.to,insert:r.blank()}};if(n<o)return{range:EditorSelection.cursor(n),changes:{from:n,to:o}}}}}return n={range:t}}));return!n&&(t(e.update(o,{scrollIntoView:!0,userEvent:"delete"})),!0)},markdownKeymap=[{key:"Enter",run:insertNewlineContinueMarkup},{key:"Backspace",run:deleteMarkupBackward}],htmlNoMatch=html({matchClosingTags:!1});function markdown(e={}){let{codeLanguages:t,defaultCodeLanguage:r,addKeymap:n=!0,base:{parser:o}=commonmarkLanguage}=e;if(!(o instanceof MarkdownParser))throw new RangeError("Base parser provided to `markdown` should be a Markdown parser");let a,i=e.extensions?[e.extensions]:[],m=[htmlNoMatch.support];r instanceof LanguageSupport?(m.push(r.support),a=r.language):r&&(a=r);let s=t||a?getCodeParser(t||[],a):void 0;return i.push(parseCode({codeParser:s,htmlParser:htmlNoMatch.language.parser})),n&&m.push(Prec.high(keymap.of(markdownKeymap))),new LanguageSupport(mkLang(o.configure(i)),m)}export{commonmarkLanguage,deleteMarkupBackward,insertNewlineContinueMarkup,markdown,markdownKeymap,markdownLanguage};
//# sourceMappingURL=/sm/ba0d878ca897ac3a30fe30d839e46a43c525b6b0783f30531c0e11487a47f783.map